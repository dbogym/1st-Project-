<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cafe Menu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
      body { background: #ddd; }
      .card {
          margin: auto; max-width: 950px; width: 90%;
          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.19); border-radius: 1rem;
      }
      .summary {
          background-color: #ddd; padding: 4vh;
          border-top-right-radius: 1rem; border-bottom-right-radius: 1rem;
      }
      .products img { width: 3.5rem; }
      .products .price, .products .action { line-height: 38px; }
  </style>
</head>
<body class="container-fluid">

<div class="row justify-content-center m-4">
  <h1 class="text-center">Grids & Circle</h1>
</div>

<!-- 관리자 페이지로 이동하는 버튼 -->
<div class="row justify-content-center m-4">
  <button id="admin-btn" class="btn btn-primary col-md-3">관리자 페이지</button>
</div>

<div class="card">
  <div class="row">
    <!-- 상품 목록 -->
    <div class="col-md-8 mt-4 p-3 pt-0">
      <h5><b>상품 목록</b></h5>
      <ul class="list-group products" id="product-list"></ul>
    </div>

    <!-- 주문 요약 -->
    <div class="col-md-4 summary p-4">
      <h5><b>Summary</b></h5>
      <hr>
      <div id="summary-list"></div>

      <form>
        <div class="mb-3">
          <label for="email" class="form-label">이메일</label>
          <input type="email" class="form-control mb-1" id="email">
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">주소</label>
          <input type="text" class="form-control mb-1" id="address">
        </div>
        <div class="mb-3">
          <label for="postcode" class="form-label">우편번호</label>
          <input type="text" class="form-control" id="postcode">
        </div>
        <div>당일 오후 2시 이후의 주문은 다음날 배송을 시작합니다.</div>
      </form>

      <div class="row pt-2 pb-2 border-top">
        <h5 class="col">총금액</h5>
        <h5 class="col text-end" id="total-price">0원</h5>
      </div>
      <button class="btn btn-dark col-12">결제하기</button>
    </div>
  </div>
</div>

<script>
  // localStorage에서 상품 데이터를 가져오거나 기본 데이터 사용
  const products = JSON.parse(localStorage.getItem('menuItems')) || [
    { name: "Columbia Nariñó", price: 5000, category: "커피콩", image: "https://i.imgur.com/HKOFQYa.jpeg", description: "부드럽고 향긋한 커피" },
    { name: "Brazil Serra Do Caparaó", price: 6000, category: "커피콩", image: "https://i.imgur.com/HKOFQYa.jpeg", description: "진하고 깊은 맛을 가진 커피" },
    { name: "Ethiopia Yirgacheffe", price: 5500, category: "커피콩", image: "https://i.imgur.com/HKOFQYa.jpeg", description: "상큼하고 신선한 맛" }
  ];

  const cart = {};

  function renderProducts() {
    const productList = document.getElementById("product-list");
    productList.innerHTML = ""; // 기존 목록 초기화
    products.forEach((product, index) => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex mt-3";
      li.innerHTML = `
        <div class="col-2"><img class="img-fluid" src="${product.image}" alt=""></div>
        <div class="col">
          <div class="row text-muted">${product.category}</div>
          <div class="row">${product.name}</div>
        </div>
        <div class="col text-center price">${product.price}원</div>
        <div class="col text-end action"><button class="btn btn-small btn-outline-dark" onclick="addToCart(${index})">추가</button></div>
      `;
      productList.appendChild(li);
    });
  }

  function addToCart(index) {
    const product = products[index];
    cart[product.name] = cart[product.name]
      ? { ...product, quantity: cart[product.name].quantity + 1 }
      : { ...product, quantity: 1 };
    updateSummary();
  }

  function removeFromCart(productName) {
    delete cart[productName];
    updateSummary();
  }

  function changeQuantity(productName, value) {
    const quantity = parseInt(value);
    if (!isNaN(quantity) && quantity > 0) {
      cart[productName].quantity = quantity;
    } else {
      delete cart[productName];
    }
    updateSummary();
  }

  function updateSummary() {
    const summaryList = document.getElementById("summary-list");
    const totalPrice = document.getElementById("total-price");
    summaryList.innerHTML = "";
    let total = 0;

    Object.values(cart).forEach(item => {
      total += item.price * item.quantity;
      const row = document.createElement("div");
      row.className = "row justify-content-between align-items-center mb-2";
      row.innerHTML = `
        <div class="col">
          <h6 class="p-0 m-0">${item.name}</h6>
        </div>
        <div class="col-auto">
          <input type="number" class="form-control form-control-sm" min="1" value="${item.quantity}" style="width: 60px;"
            onchange="changeQuantity('${item.name}', this.value)">
        </div>
        <div class="col-auto">
          <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart('${item.name}')">삭제</button>
        </div>
      `;
      summaryList.appendChild(row);
    });

    totalPrice.textContent = `${total.toLocaleString()}원`;
  }

  // 관리자 페이지로 이동
  document.getElementById('admin-btn').addEventListener('click', function() {
    window.location.href = "admin/admin.html";
  });

  window.onload = renderProducts;
</script>
</body>
</html>